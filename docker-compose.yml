services:
  karakeep-digest:
    build: .
    env_file: .env
    environment:
      - RUN_MODE=${RUN_MODE:-cli}
      - CRON_SCHEDULE=0 8 * * 0  # Sunday at 8am
    # Only restart on failure (non-zero exit), not on success
    # For CLI mode: container exits after one run
    # For daemon mode: container stays running with cron
    restart: on-failure

  # Optional: Local LLM with Ollama
  # Uncomment to use local AI instead of Anthropic
  # ollama:
  #   image: ollama/ollama
  #   volumes:
  #     - ollama_data:/root/.ollama
  #   ports:
  #     - "11434:11434"
  #   profiles:
  #     - local-llm

# volumes:
#   ollama_data:
